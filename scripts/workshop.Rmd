---
title: "workshop"
output: html_document
date: "2022-10-31"
---

```{r, message = F}
library(tidyverse)
library(magrittr)
library(here)
library(sf)
library(measurements)
library(tmap)
library(spData)
library(tmaptools)
```


```{r, message = F}
host <- read_tsv(here("data/MalAvi_9131431.tsv"))
vec <- read_tsv(here("data/MalAvi_8718204.tsv"))
```


```{r}
world <- read_sf(system.file("shapes/world.gpkg", package = "spData"))
world_crs <- st_crs(world)
world_bbox <- st_bbox(world)
```


```{r}
host_sf <- host %>% mutate(lat = gsub("\\,.*", " ", host$coordinates),
                           lon = gsub(".*,","",host$coordinates))

host_sf %<>% drop_na(coordinates)

host_sf %<>% mutate(lat = gsub(" ", "", host_sf$lat),
                    lon = gsub(" ", "", host_sf$lon))

host_sf %<>% mutate(lat = gsub("°", " ", host_sf$lat),
                    lon = gsub("°", " ", host_sf$lon))

host_sf %<>% mutate(lat = gsub(".", " ", host_sf$lat, fixed = TRUE),
                    lon = gsub(".", " ", host_sf$lon, fixed = TRUE))

host_sf %<>% mutate(lat = gsub("'", "", host_sf$lat),
                    lon = gsub("'", "", host_sf$lon))

host_sf %<>% mutate(lat = gsub("`", "", host_sf$lat),
                    lon = gsub("`", "", host_sf$lon))

host_sf %<>% mutate(lat = gsub("´", "", host_sf$lat),
                    lon = gsub("´", "", host_sf$lon))

## need to do this MANUALLY


host_sf %<>% mutate(lat_dd = as.numeric(measurements::conv_unit(host_sf$lat, from = 'deg_dec_min', to = 'dec_deg')),
                    lon_dd = as.numeric(measurements::conv_unit(host_sf$lon, from = 'deg_dec_min', to = 'dec_deg')))

host_sf %<>% drop_na(lat_dd)
host_sf %<>% drop_na(lon_dd)

host_sf %<>% filter(lat_dd > -180)

host_sf <- st_as_sf(host_sf, coords = c("lon_dd", "lat_dd"), crs = world_crs, remove = F)
```


```{r, message = F}
host_eur <- host_sf %>% filter(continent == c("Europe"))
host_afr <- host_sf %>% filter(continent == c("Africa"))
host_asia <- host_sf %>% filter(continent == c("Asia"))
host_noa <- host_sf %>% filter(continent == c("North America"))
host_oce <- host_sf %>% filter(continent == c("Oceania"))
host_soa <- host_sf %>% filter(continent == c("South America"))
host_usa <- host_sf %>% filter(country == c("United States"))

host_eao <- rbind(host_eur, host_afr)
#vec_eao <- vec %>% filter(country == c("Austria", "Bulgaria", "Cameroon", "Czech Republic", "France", "Germany", "Italy", "Lithuania", "Madagascar", "Portugal", "Russia", "Spain", "Switzerland", "Turkey"))
```

# Summary of data availability

```{r}
plot(host_eao)
tm_shape(host_eao, bbox = world_bbox) + tm_dots()
```



# Preliminary plots/maps

```{r}
border_eur <- world %>% filter(continent == c("Europe"))
border_afr <- world %>% filter(continent == c("Africa"))

border_eao <- rbind(border_eur, border_afr)



no_am <- world %>% filter(subregion %in% c("Caribbean","Northern America","Central America"))

tm_shape(no_am) + tm_borders() + tm_grid() + tm_shape(host_noa) + tm_dots()


```

```{r}
tm_shape(world) + tm_borders()
tm_shape(world) + tm_polygons()
tm_shape(host_afr) + tm_dots()
tm_shape(host_asia) + tm_dots()
tm_shape(host_eur) + tm_dots()
tm_shape(host_noa) + tm_dots()
tm_shape(host_oce) + tm_dots()
tm_shape(host_soa) + tm_dots()

tm_shape(host_sf, bbox = world_bbox) + tm_dots() + tm_shape(world) + tm_borders()
```


```{r}
plot(st_geometry(border_eao))
plot(st_geometry(host_eao), add = T)
```



# EcoRegions

```{r}
ecoregions <- read_sf(here("data/us_eco_l3_state_boundaries/us_eco_l3_state_boundaries.shp"))
#ecoregions <- ecoregions(class="sf")
ecoregions_2 <- st_transform(ecoregions, world_crs)

eco_simple <- simplify_shape(ecoregions_2)
```

```{r}
us_ecoregions_map <- tm_shape(ecoregions) + tm_polygons()

us_ecoregions_map + tm_shape(host_usa) + tm_dots()
```


