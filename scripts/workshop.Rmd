---
title: "workshop"
output: html_document
date: "2022-10-31"
---

```{r, message = F}
library(tidyverse)
library(magrittr)
library(here)
library(sf)
library(measurements)
library(tmap)
library(spData)
```


```{r, message = F}
host <- read_tsv(here("data/MalAvi_9131431.tsv"))
vec <- read_tsv(here("data/MalAvi_8718204.tsv"))
```


```{r}
world <- read_sf(system.file("shapes/world.gpkg", package = "spData"))
world_crs <- st_crs(world)


host_sf <- host %>% mutate(lat = gsub("\\,.*", " ", host$coordinates),
                           lon = gsub(".*,","",host$coordinates))

host_sf %<>% drop_na(coordinates)

host_sf %<>% mutate(lat = gsub(" ", "", host_sf$lat),
                    lon = gsub(" ", "", host_sf$lon))

host_sf %<>% mutate(lat = gsub("°", " ", host_sf$lat),
                    lon = gsub("°", " ", host_sf$lon))

host_sf %<>% mutate(lat = gsub("'", "", host_sf$lat),
                    lon = gsub("'", "", host_sf$lon))

host_sf %<>% mutate(lat = gsub("`", "", host_sf$lat),
                    lon = gsub("`", "", host_sf$lon))

host_sf %<>% mutate(lat = gsub("´", "", host_sf$lat),
                    lon = gsub("´", "", host_sf$lon))


host_sf %<>% mutate(lat = measurements::conv_unit(host_sf$lat, from = 'deg_dec_min', to = 'dec_deg'),
                    lon = measurements::conv_unit(host_sf$lon, from = 'deg_dec_min', to = 'dec_deg'))

host_sf %<>% drop_na(lat)
host_sf %<>% drop_na(lon)

host_sf <- st_as_sf(host_sf, coords = c("lat", "lon"), crs = world_crs, remove = F)

```


```{r, message = F}
host_eur <- host_sf %>% filter(continent == c("Europe"))
host_afr <- host_sf %>% filter(continent == c("Africa"))
host_eao <- rbind(host_eur, host_afr)
#vec_eao <- vec %>% filter(country == c("Austria", "Bulgaria", "Cameroon", "Czech Republic", "France", "Germany", "Italy", "Lithuania", "Madagascar", "Portugal", "Russia", "Spain", "Switzerland", "Turkey"))
```

# Summary of data availability

```{r}
plot(host_eao)
tm_shape(host_eao) + tm_dots()
```



# Preliminary plots/maps

```{r}
border_eur <- world %>% filter(continent == c("Europe"))
border_afr <- world %>% filter(continent == c("Africa"))
border_eao <- rbind(border_eur, border_afr)
```

```{r}
tm_shape(world) + tm_borders()
tm_shape(world) + tm_polygons()
tm_shape(host_sf) + tm_dots()
```


```{r}
plot(st_geometry(border_eao))
plot(st_geometry(host_eao), add = T)
```



# EcoRegions

```{r}
ecoregions <- read_sf(here("data/us_eco_l3_state_boundaries/us_eco_l3_state_boundaries.shp"))
st_crs(ecoregions) <- world_crs
```



